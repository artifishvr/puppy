---
import Layout from "../layouts/Layout.astro";
---

<Layout title="woof">
  <main>
    <div class="flex items-center justify-center min-h-screen w-full">
      <button
        class="text-5xl hover:scale-110 transition-transform"
        aria-label="Click to bark">🐕</button
      >
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const button = document.querySelector("button");
      if (!button) return;
      button.addEventListener("click", onClick);
    });

    async function onClick() {
      const barks = ["/bark1.mp3", "/bark2.mp3", "/bark3.mp3", "/bark4.mp3"];
      const randomIndex = Math.floor(Math.random() * barks.length);
      const randomBark = barks[randomIndex];

      // Create new audio context on each click
      const audioContext = new window.AudioContext();
      const audio = new Audio(randomBark);
      audio.volume = 0.5;
      const source = audioContext.createMediaElementSource(audio);
      source.connect(audioContext.destination);

      try {
        // Resume audio context (needed for Chrome)
        if (audioContext.state === "suspended") {
          await audioContext.resume();
        }

        // Wait for audio to be loaded
        await new Promise((resolve, reject) => {
          audio.addEventListener("canplaythrough", resolve, { once: true });
          audio.addEventListener("error", reject, { once: true });
          audio.load();
        });

        // Play and wait for completion
        await audio.play();

        await new Promise((resolve) => {
          audio.addEventListener("ended", resolve, { once: true });
        });
      } catch (error) {
        console.error("Audio playback failed:", error);
      }
    }
  </script>
</Layout>
